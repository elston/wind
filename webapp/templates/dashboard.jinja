<div class="container">
    <div class="row">
        <div class="col-md-8">
            <h3>Wind parks</h3>

            <div ng-controller="WindParksCtrl">
                <div id="windparks-grid" ui-grid="gridOptions" ui-grid-selection class="grid" ui-grid-auto-resize></div>
                <div ng-if='noWindParks' class="ng-cloak">
                    <h3 align="center">No data. Use "hamburger" menu at top right corner to add wind park.</h3>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <h3>Status</h3>

            <div ng-controller="StatusCtrl">
                <h5>No background processes</h5>
            </div>
        </div>
    </div>
</div>
{% raw %}  <!-- Angular templating -->
<script type="text/ng-template" id="new-windpark.html">
    <div class="modal-header">
        <h4 class="modal-title" id="new-windpark-dialog-label">Add new wind park</h4>
    </div>

    <div class="modal-body">
        <div class="container-fluid">
            <form class="form-horizontal" name="newWindparkForm">

                <div class="form-group">
                    <label for="windpark-name" class="col-xs-3 control-label">Name: </label>

                    <div class="col-xs-9">
                        <input type="text" ng-model="name" id="windpark-name" name="windpark-name"
                               class="form-control" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="windpark-location" class="col-xs-3 control-label">Location: </label>

                    <div class="col-xs-9">
                        <select id="windpark-location" class="form-control" ng-model="location" required>
                            <option ng-repeat="location in locations" value="{{ location.id }}">{{ location.name }}
                            </option>
                        </select>

                    </div>
                </div>
                <div class="form-group">
                    <label for="windpark-market" class="col-xs-3 control-label">Market: </label>

                    <div class="col-xs-9">
                        <select id="windpark-market" class="form-control" ng-model="market" required>
                            <option ng-repeat="market in markets" value="{{ market.id }}">{{ market.name }}
                            </option>
                        </select>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="modal-footer">
        <button type="button" class="btn btn-default" ng-click="close()">Close</button>
        <button type="button" id="new-windpark" class="btn btn-warning"
                ng-disabled="!newWindparkForm.$valid" ng-click="addWindPark()">Add
        </button>
    </div>
</script>

<script type="text/ng-template" id="upload-generation-modal.html">
    <div class="modal-header">
        <h4 class="modal-title" id="generation-upload-modal-label">Generation upload for wind park "{{ windParkName
            }}"</h4>
    </div>
    <div class="modal-body">
        <div class="container-fluid">
            <form class="form-horizontal" name="generationUploadForm">
                <div class="form-group">
                    <label for="format" class="col-xs-2 control-label">File format: </label>

                    <div class="input-group col-xs-10">
                        <select id="format" class="form-control" ng-model="fileFormat" required>
                            <option value="sotavento">Sotavento public data CSV</option>
                            <option value="custom">2 columns, date and power (MW)</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="upload-generation" class="col-xs-2 control-label">File</label>

                    <div class="input-group col-xs-10" id="upload-generation">
                        <label class="input-group-btn">
                    <span class="btn btn-primary">
                        Browse&hellip; <input ngf-select ng-model="generationFile" type="file" style="display: none;"
                                              required>
                    </span>
                        </label>
                        <input ng-model="generationFile.name" type="text" class="form-control" readonly>
                    <span class="input-group-btn"><button class="btn btn-info"
                                                          ng-click="previewFile(generationFile)"
                                                          ng-disabled="!generationUploadForm.$valid">
                        Preview
                    </button></span>
                    <span class="input-group-btn"><button class="btn btn-warning"
                                                          ng-click="uploadGeneration()"
                                                          ng-disabled="!generationUploadForm.$valid">
                        Upload
                    </button></span>
                    </div>
                </div>
            </form>
        </div>

        <div id="generation-upload-chart-container" style="width:100%; height:400px;"></div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-default" ng-click="close()">Close</button>
    </div>
</script>

<script type="text/ng-template" id="windpark-data.html">
    <div class="container" ng-controller="WindParkDataCtrl">
        <div class="row">
            <div class="col-xs-12">
                <form class="form-horizontal clearfix" name="newWindparkForm"
                      style="margin-top:34px; margin-bottom:34px">
                    <div class="form-group">
                        <label for="windpark-data-name" class="col-xs-3 control-label">Name: </label>

                        <div class="col-xs-9">
                            <input type="text" ng-model="name" id="windpark-data-name" name="windpark-name"
                                   class="form-control" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="windpark-data-location" class="col-xs-3 control-label">Location: </label>

                        <div class="col-xs-9">
                            <select id="windpark-data-location" class="form-control" ng-model="location" required
                                    ng-options="location.name for location in locations track by location.id">
                            </select>

                        </div>
                    </div>
                    <div class="form-group">
                        <label for="windpark-data-market" class="col-xs-3 control-label">Market: </label>

                        <div class="col-xs-9">
                            <select id="windpark-data-market" class="form-control" ng-model="market" required
                                    ng-options="market.name for market in markets track by market.id">
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-xs-3 control-label">Power curve source: </label>

                        <div class="col-xs-9">
                            <label class="radio-inline">
                                <input type="radio" name="windpark-data-source" ng-model="dataSource" value="turbines">
                                From turbines characteristics</label>
                            <label class="radio-inline">
                                <input type="radio" name="windpark-data-source" ng-model="dataSource" value="historical"
                                       selected>
                                From historical wind and generation data</label>
                        </div>
                    </div>

                    <button type="button" class="btn btn-warning pull-right" ng-click="update()">Update</button>
                </form>
            </div>
        </div>
        <div class="col-xs-12">
            <div class="panel panel-info" ng-if="dataSource == 'turbines'">
                <div class="panel-heading"><h4 class="panel-title">Turbines characteristics</h4>
                </div>
                <div class="panel-body" ng-controller="WindparkTurbinesCtrl">
                    <h4>Turbines</h4>

                    <div id="turbines-list-grid" ui-grid="actualListOptions" ui-grid-selection
                         class="grid" ui-grid-auto-resize></div>
                    <div id="total-power-curve-container" style="width:100%; height:450px;"></div>
                </div>
            </div>
            <div class="panel panel-info" ng-if="dataSource == 'historical'">
                <div class="panel-heading"><h4 class="panel-title">Historical wind and generation data</h4>
                </div>
                <div class="panel-body" ng-controller="WindparkGenerationCtrl">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-xs-4">
                                <span class="data-label"><b>Start</b></span>{{ summary.start | date:'MMM d, y
                                H:mm':'gmt' }}
                            </div>
                            <div class="col-xs-4">
                                <span class="data-label"><b>End</b></span>{{ summary.end | date:'MMM d, y H:mm':'gmt' }}
                            </div>
                            <div class="col-xs-4">
                                <span class="data-label"><b>Min power, MW</b></span>{{ summary.min | number:2 }}
                            </div>
                            <div class="col-xs-4">
                                <span class="data-label"><b>Max power, MW</b></span>{{ summary.max | number:2 }}
                            </div>
                            <div class="col-xs-4">
                                <span class="data-label"><b>Mean power, MW</b></span>{{ summary.mean | number:2 }}
                            </div>
                            <div class="col-xs-4">
                                <span class="data-label"><b>Power std, MW</b></span>{{ summary.std | number:2 }}
                            </div>
                        </div>
                        <p></p>

                        <div class="row">
                            <div class="col-xs-4 col-xs-offset-1">
                                <button class="btn btn-info" style="width:100%"
                                        ng-click="summary.showGeneration = !summary.showGeneration"
                                        ng-disabled="summary.max === null">Generation plot
                                </button>
                            </div>
                            <div class="col-xs-4 col-xs-offset-2">
                                <button class="btn btn-info" style="width:100%"
                                        ng-click="summary.showWindVsPower = !summary.showWindVsPower"
                                        ng-disabled="summary.max === null">Wind vs Power
                                </button>
                            </div>
                        </div>
                        <p></p>

                        <div uib-collapse="!summary.showGeneration" expanded="plotGeneration()"
                             collapsed="cleanGenerationPlot()">
                            <div class="well well-lg">
                                <div id="plot-generation" style="width:100%; height:400px;"></div>
                            </div>
                        </div>
                        <p></p>

                        <div uib-collapse="!summary.showWindVsPower" expanded="plotWindVsPower()"
                             collapsed="cleanWindVsPowerPlot()">
                            <div class="well well-lg">
                                <dl class="dl-horizontal">
                                    <dt>V<sub>cut-in</sub></dt>
                                    <dd>{{ beta[0] | number:2 }}±{{ sd_beta[0] | number:2 }}</dd>
                                    <dt>V<sub>rated</sub></dt>
                                    <dd>{{ beta[1] | number:2 }}±{{ sd_beta[1] | number:2 }}</dd>
                                    <dt>V<sub>cut-out</sub></dt>
                                    <dd>{{ beta[2] | number:2 }}±{{ sd_beta[2] | number:2 }}</dd>
                                    <dt>W<sub>rated</sub></dt>
                                    <dd>{{ beta[3] | number:2 }}±{{ sd_beta[3] | number:2 }}</dd>
                                </dl>
                                <div id="plot-wind-vs-power" style="width:100%; height:400px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel panel-info" ng-controller="WindParkSimulationCtrl">
                <div class="panel-heading">
                    <h4 class="panel-title"><a href class="accordion-toggle"
                                               ng-click="status.isDetailsOpen = !status.isDetailsOpen">
                        Inspect simulations</a></h4>
                </div>
                <div class="panel-collapse collapse" uib-collapse="!status.isDetailsOpen"
                     expanded="showDetails()">
                    <div class="panel-body">
                        <h4>Wind & power simulation</h4>

                        <form class="form-horizontal">
                            <div class="form-group">
                                <label for="time-span" class="col-xs-2 control-label">Time span: </label>

                                <div class="col-xs-1">
                                    <input type="number" ng-model="timeSpan" id="time-span"
                                           class="form-control" required>
                                </div>
                                <label for="n-samples" class="col-xs-2 control-label"># samples: </label>

                                <div class="col-xs-1">
                                    <input type="number" ng-model="nSamples" id="n-samples"
                                           class="form-control" required>
                                </div>

                                <label for="n-reduced-samples" class="col-xs-2 control-label"># reduced: </label>

                                <div class="col-xs-1">
                                    <input type="number" ng-model="nReducedSamples" id="n-reduced-samples"
                                           class="form-control" required>
                                </div>

                                <div class="col-xs-3">
                                    <button class="btn btn-info" style="width:100%"
                                            ng-click="updateWindSimulation()">Repeat simulation
                                    </button>
                                </div>
                            </div>
                        </form>
                        <div id="wind-sim" style="width:100%; height:300px;"></div>
                        <div id="power-sim" style="width:100%; height:300px;"></div>
                        <div id="wind-red-sim" style="width:100%; height:300px;"></div>
                        <div id="power-red-sim" style="width:100%; height:300px;"></div>

                        <h4>Market simulation</h4>

                        <form class="form-horizontal">
                            <div class="form-group">
                                <label for="day-start" class="col-xs-3 control-label">Day start hour: </label>

                                <div class="col-xs-2">
                                    <input type="number" ng-model="dayStart" id="day-start"
                                           class="form-control" required>
                                </div>
                                <div class="col-xs-2 col-xs-offset-5">
                                    <button class="btn btn-info" style="width:100%"
                                            ng-click="updateMarketSimulation()">Repeat simulation
                                    </button>
                                </div>
                            </div>
                        </form>
                        <div id="lambdad-sim" style="width:100%; height:300px;"></div>
                        <div id="lambdad-red-sim" style="width:100%; height:300px;"></div>
                        <div id="mavsmd-sim" style="width:100%; height:300px;"></div>
                        <div id="mavsmd-red-sim" style="width:100%; height:300px;"></div>
                        <div id="sqrtr-sim" style="width:100%; height:300px;"></div>
                        <div id="sqrtr-red-sim" style="width:100%; height:300px;"></div>
                    </div>
                </div>
            </div>

            <div class="panel panel-primary" ng-controller="WindParkOptimizationCtrl">
                <div class="panel-heading">
                    <h4 class="panel-title">Optimization</h4>
                </div>
                <div class="panel-body">
                    <div class="container-fluid">
                        <form class="form-horizontal">
                            <div class="form-group form-group-sm">
                                <div class="col-xs-4">
                                    <label class="checkbox">
                                        <input type="checkbox" ng-model="windpark.optimization_job.refit_weather">Recalculate
                                        wind model</label>
                                </div>
                                <div class="col-xs-4">
                                    <label class="checkbox">
                                        <input type="checkbox" ng-model="windpark.optimization_job.refit_market">Recalculate
                                        market model</label>
                                </div>
                                <label class="col-xs-2 control-label"># wind scenarios: </label>

                                <div class="col-xs-2">
                                    <input type="number" ng-model="windpark.optimization_job.n_wind_scenarios"
                                           class="form-control" required>
                                </div>
                            </div>

                            <div class="form-group form-group-sm">
                                <label class="col-xs-2 control-label"># reduced wind scenarios: </label>

                                <div class="col-xs-2">
                                    <input type="number" ng-model="windpark.optimization_job.n_redc_wind_scenarios"
                                           class="form-control" required>
                                </div>

                                <label class="col-xs-2 control-label"># DA price scenarios: </label>

                                <div class="col-xs-2">
                                    <input type="number" ng-model="windpark.optimization_job.n_lambdaD_scenarios"
                                           class="form-control" required>
                                </div>
                                <label class="col-xs-2 control-label"># reduced DA price
                                    scenarios: </label>

                                <div class="col-xs-2">
                                    <input type="number" ng-model="windpark.optimization_job.n_redc_lambdaD_scenarios"
                                           class="form-control"
                                           required>
                                </div>
                            </div>

                            <div class="form-group form-group-sm">
                                <label class="col-xs-2 control-label"># MAvsMD scenarios: </label>

                                <div class="col-xs-2">
                                    <input type="number" ng-model="windpark.optimization_job.n_MAvsMD_scenarios"
                                           class="form-control" required>
                                </div>

                                <label class="col-xs-2 control-label"># reduced MAvsMD scenarios: </label>

                                <div class="col-xs-2">
                                    <input type="number" ng-model="windpark.optimization_job.n_redc_MAvsMD_scenarios"
                                           class="form-control"
                                           required>
                                </div>
                                <label class="col-xs-2 control-label"># imbalance scenarios: </label>

                                <div class="col-xs-2">
                                    <input type="number" ng-model="windpark.optimization_job.n_sqrt_r_scenarios"
                                           class="form-control" required>
                                </div>

                            </div>

                            <div class="form-group form-group-sm">
                                <label class="col-xs-2 control-label"># reduced imbalance scenarios: </label>

                                <div class="col-xs-2">
                                    <input type="number" ng-model="windpark.optimization_job.n_redc_sqrt_r_scenarios"
                                           class="form-control"
                                           required>
                                </div>
                                <label class="col-xs-2 control-label">Market start hour: </label>

                                <div class="col-xs-2">
                                    <input type="number" ng-model="windpark.optimization_job.market_start_hour"
                                           class="form-control"
                                           required>
                                </div>
                                <label class="col-xs-2 control-label">Date: </label>

                                <div class="col-xs-2">
                                    <input type="date" ng-model="optimizationDate"
                                           class="form-control" required>
                                </div>

                            </div>

                            <div class="form-group form-group-sm">
                                <label class="col-xs-2 control-label">Maximum power, MW: </label>

                                <div class="col-xs-2">
                                    <input type="number" ng-model="windpark.optimization_job.Pmax" class="form-control"
                                           required>
                                </div>
                                <label class="col-xs-2 control-label">alpha: </label>

                                <div class="col-xs-2">
                                    <input type="number" ng-model="windpark.optimization_job.alpha" class="form-control"
                                           required>
                                </div>
                                <label class="col-xs-2 control-label">beta: </label>

                                <div class="col-xs-2">
                                    <input type="number" ng-model="windpark.optimization_job.beta" class="form-control"
                                           required>
                                </div>
                            </div>
                        </form>

                        <div class="row">
                            <div class="col-xs-4 col-xs-offset-4">
                                <button type="button" class="btn btn-primary btn-lg" ng-click="optimize()"
                                        ng-disabled="startDisabled"
                                        style="width: 100%">Optimize
                                </button>
                            </div>
                        </div>
                    </div>
                    <h4>Status: {{ statusData.status }}</h4>
                    <pre>{{ statusData.log }}</pre>
                    <pre class="bg-danger" ng-if="statusData.isFailed">{{ statusData.error }}</pre>
                    <!--<pre>{{ optimizationResults }}</pre>-->
                    <dl class="dl-horizontal">
                        <dt>Calculation start:</dt>
                        <dd>{{ optimizationResults.computing_start }}</dd>
                        <dt>Calculation finish:</dt>
                        <dd>{{ optimizationResults.computing_finish }}</dd>
                        <dt>Expected profit:</dt>
                        <dd>{{ optimizationResults.expected_profit | number:0 }}</dd>
                        <dt>profit std:</dt>
                        <dd>{{ optimizationResults.profit_std | number:0 }}</dd>
                        <dt>cvar:</dt>
                        <dd>{{ optimizationResults.cvar | number:0 }}</dd>
                    </dl>
                    <div id="da-volumes" style="width:100%; height:300px;"></div>
                    <div id="am-volumes" style="width:100%; height:300px;"></div>
                    <div id="total-volumes" style="width:100%; height:300px;"></div>
                </div>
            </div>
        </div>
    </div>
</script>

<script type="text/ng-template" id="add-turbine.html">
    <div class="modal-header">
        <h4 class="modal-title" id="add-turbine-dialog-label">Add turbine to the wind park</h4>
    </div>

    <div class="modal-body">
        <div class="container-fluid">
            <form class="form-horizontal" name="addTurbineForm">

                <div class="form-group">
                    <label for="windpark-name" class="col-xs-3 control-label">Count: </label>

                    <div class="col-xs-9">
                        <input type="number" ng-model="count" id="count" name="count"
                               class="form-control" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="windpark-location" class="col-xs-3 control-label">Name: </label>

                    <div class="col-xs-9">
                        <input type="text" ng-model="selectedTurbine.name" id="selected-name" name="selected-name"
                               class="form-control" required disabled>
                    </div>
                </div>
            </form>
            <div class="row" ng-if="selectedTurbine">
                <pre class="col-xs-6">{{ selectedTurbine.description }}</pre>
                <div class="col-xs-6">
                    <div id="selected-power-curve-container" style="width:100%; height:300px;"></div>
                </div>
            </div>
            <div id="all-turbines-list-grid" ui-grid="allTurbinesListOptions" ui-grid-selection
                 class="grid" ui-grid-auto-resize></div>

        </div>
    </div>

    <div class="modal-footer">
        <button type="button" class="btn btn-default" ng-click="close()">Close</button>
        <button type="button" id="add-turbine" class="btn btn-warning"
                ng-disabled="!addTurbineForm.$valid" ng-click="addTurbine()">Add
        </button>
    </div>
</script>
{% endraw %}
